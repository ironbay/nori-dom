{"version":3,"sources":["../src/formats.ts","node_modules/universal-websocket-client/browser.js","../src/sleep.ts","../src/dispatcher.ts","../src/transports.ts","../src/client.ts","../src/index.ts","../../js/src/events.ts","../../js/src/index.ts","src/index.ts"],"names":[],"mappings":"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","file":"src.f10117fe.map","sourceRoot":"..","sourcesContent":["export class Json implements Riptide.Format {\n    encode(input) {\n        return JSON.stringify(input)\n    }\n    decode<T>(input) {\n        return JSON.parse(input) as T\n    }\n}","'use strict';\n\nmodule.exports = WebSocket;\n","export default function (time: number) {\n    return new Promise<number>((resolve) => {\n        setTimeout(() => resolve(time), time)\n    })\n}","class Dispatcher<T> {\n    private callbacks = new Array<Callback<T>>()\n    private timeout = null\n\n    public add(cb: Callback<T>) {\n        this.callbacks.push(cb)\n    }\n\n    public trigger(msg: T, delay = 0) {\n        if (delay === 0) {\n            this.callbacks.forEach(cb => cb(msg))\n            return\n        }\n        clearTimeout(this.timeout)\n        this.timeout = setTimeout(() => {\n            this.callbacks.forEach(cb => cb(msg))\n        }, delay)\n    }\n\n}\n\nexport type Callback<T> = (msg: T) => void\n\nexport default Dispatcher","import * as WebSocket from 'universal-websocket-client'\nimport sleep from './sleep'\nimport Dispatcher from './dispatcher'\n\nexport abstract class TransportBase implements Riptide.Transport {\n    abstract write(data: string)\n    protected on_data = new Dispatcher<string>()\n\n    subscribe(cb: (data: string) => void) {\n        this.on_data.add(cb)\n    }\n}\n\nexport class WS extends TransportBase {\n    public attempts = -1\n    public on_status = new Dispatcher<string>()\n    private socket: WebSocket;\n\n    write(data: string) {\n        if (!this.socket || this.socket.readyState !== 1) throw 'Socket unready'\n        this.socket.send(data)\n    }\n\n\n    async connect(url: string) {\n        this.attempts++\n        await sleep(Math.min(this.attempts * 1000, 5 * 1000))\n        this.socket = new WebSocket(url)\n        this.socket.onopen = () => {\n            this.attempts = 0\n            this.on_status.trigger('ready')\n        }\n\n        this.socket.onclose = () => {\n            this.cleanup()\n            this.connect(url)\n        }\n\n        this.socket.onerror = err => {\n            // this._cleanup()\n            // this._connect()\n        }\n\n        this.socket.onmessage = event => {\n            this.on_data.trigger(event.data)\n        }\n    }\n\n    disconnect() {\n        if (!this.socket) return\n        this.socket.onclose = () => { }\n        this.socket.close()\n        this.cleanup()\n    }\n\n\n    private cleanup() {\n        this.on_status.trigger('disconnected')\n        this.socket = undefined\n    }\n}","import sleep from './sleep'\nimport Dispatcher from './dispatcher'\n\nexport default class Client<T extends Riptide.Transport, F extends Riptide.Format> {\n    public transport: T\n    public format: F\n    public counter: number = 0\n    public on_cast = new Dispatcher<Riptide.Message>()\n    private private = new Map<number, { resolve: any, reject: any }>()\n\n    constructor(transport: { new(): T } = null, format: { new(): F } = null) {\n        this.transport = new transport()\n        this.transport.subscribe(data => this.handle_data(data))\n        this.format = new format()\n    }\n\n    async call<T>(action: string, body: any) {\n        this.counter++\n        const promise = new Promise<T>((resolve, reject) => {\n            this.private.set(this.counter, { resolve, reject })\n        })\n        await this.write({\n            key: this.counter,\n            action,\n            body,\n            type: 'call'\n        })\n        return promise\n    }\n\n    async cast(action: string, body: any) {\n        await this.write({\n            action,\n            body,\n            type: 'cast'\n        })\n\n    }\n\n    private async write(msg: Riptide.Message) {\n        msg.version = 1\n        const encoded = this.format.encode(msg)\n        try {\n            this.transport.write(encoded)\n        } catch (ex) {\n            await sleep(1000)\n            return await this.write(msg)\n        }\n\n    }\n\n    private handle_data(data: string) {\n        const msg = this.format.decode<Riptide.Message>(data)\n        const match = this.private.get(msg.key)\n        switch (msg.action) {\n            case 'reply':\n                match.resolve(msg.body)\n                this.private.delete(msg.key)\n            case 'error':\n                match.reject(msg.body)\n                this.private.delete(msg.key)\n            default:\n                this.on_cast.trigger(msg)\n        }\n    }\n\n}\n\n","import * as Riptide from '@ironbay/riptide'\nimport Nori from '../../../js/src/index'\n\nconst root = document.getElementById('root')\nconst nori = new Nori(root)\n\n\nasync function run() {\n    const riptide = new Riptide.Client(Riptide.Transports.WS, Riptide.Formats.Json)\n    riptide.transport.connect('ws://localhost:12000/socket')\n    riptide.transport.on_status.add(async status => {\n        if (status !== 'ready') return\n        const patch = await riptide.call('nori.init', true) as any\n        root.innerHTML = ''\n        nori.patch(patch)\n    })\n\n    nori.onevent = async e => {\n        const patch = await riptide.call('nori.event', e) as any\n        nori.patch(patch)\n    }\n}\n\nrun()","function define<K extends keyof WindowEventMap>(name: K, transform: (e: WindowEventMap[K]) => any) {\n    return {\n        name,\n        transform\n    }\n}\n\nfunction mouse_event(e: MouseEvent) {\n    return {\n        ...base_event(e),\n        altKey: e.altKey,\n        button: e.button,\n        buttons: e.buttons,\n        clientX: e.clientX,\n        clientY: e.clientY,\n        ctrlKey: e.ctrlKey,\n        layerX: e.layerX,\n        layerY: e.layerY,\n        metaKey: e.metaKey,\n        movementX: e.movementX,\n        movementY: e.movementY,\n        offsetX: e.offsetX,\n        offsetY: e.offsetY,\n        pageX: e.pageX,\n        pageY: e.pageY,\n        screenX: e.screenX,\n        screenY: e.screenY,\n        shiftKey: e.shiftKey,\n        x: e.x,\n        y: e.y,\n    }\n}\n\nfunction keyboard_event(e: KeyboardEvent) {\n    return {\n        ...base_event(e),\n        altKey: e.altKey,\n        code: e.code,\n        ctrlKey: e.ctrlKey,\n        key: e.key,\n        location: e.location,\n        metaKey: e.metaKey,\n        repeat: e.repeat,\n        shiftKey: e.shiftKey,\n        which: e.which,\n    }\n}\n\nfunction base_event(e: Event) {\n    return {\n        value: (e.target as any).value\n    }\n}\n\nexport default {\n    'on_click': define('click', mouse_event),\n    \"on_abort\": define('abort', base_event),\n    \"on_afterprint\": define('afterprint', base_event),\n    \"on_beforeprint\": define('beforeprint', base_event),\n    \"on_beforeunload\": define('beforeunload', base_event),\n    \"on_blur\": define('blur', base_event),\n    \"on_canplay\": define(\"canplay\", base_event),\n    \"on_canplaythrough\": define(\"canplaythrough\", base_event),\n    \"on_change\": define(\"change\", base_event),\n    \"on_compassneedscalibration\": define(\"compassneedscalibration\", base_event),\n    \"on_contextmenu\": define(\"contextmenu\", base_event),\n    \"on_dblclick\": define(\"dblclick\", base_event),\n    \"on_devicelight\": define(\"devicelight\", base_event),\n    \"on_devicemotion\": define(\"devicemotion\", base_event),\n    \"on_deviceorientation\": define(\"deviceorientation\", base_event),\n    \"on_drag\": define(\"drag\", base_event),\n    \"on_dragend\": define(\"dragend\", base_event),\n    \"on_dragenter\": define(\"dragenter\", base_event),\n    \"on_dragleave\": define(\"dragleave\", base_event),\n    \"on_dragover\": define(\"dragover\", base_event),\n    \"on_dragstart\": define(\"dragstart\", base_event),\n    \"on_drop\": define(\"drop\", base_event),\n    \"on_durationchange\": define(\"durationchange\", base_event),\n    \"on_emptied\": define(\"emptied\", base_event),\n    \"on_ended\": define(\"ended\", base_event),\n    \"on_error\": define(\"error\", base_event),\n    \"on_focus\": define(\"focus\", base_event),\n    \"on_hashchange\": define(\"hashchange\", base_event),\n    \"on_input\": define(\"input\", base_event),\n    \"on_invalid\": define(\"invalid\", base_event),\n    \"on_keydown\": define(\"keydown\", keyboard_event),\n    \"on_keypress\": define(\"keypress\", keyboard_event),\n    \"on_keyup\": define(\"keyup\", keyboard_event),\n    \"on_load\": define(\"load\", base_event),\n    \"on_loadeddata\": define(\"loadeddata\", base_event),\n    \"on_loadedmetadata\": define(\"loadedmetadata\", base_event),\n    \"on_loadstart\": define(\"loadstart\", base_event),\n    \"on_message\": define(\"message\", base_event),\n    \"on_mousedown\": define(\"mousedown\", mouse_event),\n    \"on_mouseenter\": define(\"mouseenter\", mouse_event),\n    \"on_mouseleave\": define(\"mouseleave\", mouse_event),\n    \"on_mousemove\": define(\"mousemove\", mouse_event),\n    \"on_mouseout\": define(\"mouseout\", mouse_event),\n    \"on_mouseover\": define(\"mouseover\", mouse_event),\n    \"on_mouseup\": define(\"mouseup\", mouse_event),\n    \"on_mousewheel\": define(\"mousewheel\", mouse_event),\n    \"on_MSGestureChange\": define(\"MSGestureChange\", base_event),\n    \"on_MSGestureDoubleTap\": define(\"MSGestureDoubleTap\", base_event),\n    \"on_MSGestureEnd\": define(\"MSGestureEnd\", base_event),\n    \"on_MSGestureHold\": define(\"MSGestureHold\", base_event),\n    \"on_MSGestureStart\": define(\"MSGestureStart\", base_event),\n    \"on_MSGestureTap\": define(\"MSGestureTap\", base_event),\n    \"on_MSInertiaStart\": define(\"MSInertiaStart\", base_event),\n    \"on_MSPointerCancel\": define(\"MSPointerCancel\", base_event),\n    \"on_MSPointerDown\": define(\"MSPointerDown\", base_event),\n    \"on_MSPointerEnter\": define(\"MSPointerEnter\", base_event),\n    \"on_MSPointerLeave\": define(\"MSPointerLeave\", base_event),\n    \"on_MSPointerMove\": define(\"MSPointerMove\", base_event),\n    \"on_MSPointerOut\": define(\"MSPointerOut\", base_event),\n    \"on_MSPointerOver\": define(\"MSPointerOver\", base_event),\n    \"on_MSPointerUp\": define(\"MSPointerUp\", base_event),\n    \"on_offline\": define(\"offline\", base_event),\n    \"on_online\": define(\"online\", base_event),\n    \"on_orientationchange\": define(\"orientationchange\", base_event),\n    \"on_pagehide\": define(\"pagehide\", base_event),\n    \"on_pageshow\": define(\"pageshow\", base_event),\n    \"on_pause\": define(\"pause\", base_event),\n    \"on_play\": define(\"play\", base_event),\n    \"on_playing\": define(\"playing\", base_event),\n    \"on_popstate\": define(\"popstate\", base_event),\n    \"on_progress\": define(\"progress\", base_event),\n    \"on_ratechange\": define(\"ratechange\", base_event),\n    \"on_readystatechange\": define(\"readystatechange\", base_event),\n    \"on_reset\": define(\"reset\", base_event),\n    \"on_resize\": define(\"resize\", base_event),\n    \"on_scroll\": define(\"scroll\", base_event),\n    \"on_seeked\": define(\"seeked\", base_event),\n    \"on_seeking\": define(\"seeking\", base_event),\n    \"on_select\": define(\"select\", base_event),\n    \"on_stalled\": define(\"stalled\", base_event),\n    \"on_storage\": define(\"storage\", base_event),\n    \"on_submit\": define(\"submit\", base_event),\n    \"on_suspend\": define(\"suspend\", base_event),\n    \"on_timeupdate\": define(\"timeupdate\", base_event),\n    \"on_unload\": define(\"unload\", base_event),\n    \"on_volumechange\": define(\"volumechange\", base_event),\n    \"on_vrdisplayactivate\": define(\"vrdisplayactivate\", base_event),\n    \"on_vrdisplayblur\": define(\"vrdisplayblur\", base_event),\n    \"on_vrdisplayconnect\": define(\"vrdisplayconnect\", base_event),\n    \"on_vrdisplaydeactivate\": define(\"vrdisplaydeactivate\", base_event),\n    \"on_vrdisplaydisconnect\": define(\"vrdisplaydisconnect\", base_event),\n    \"on_vrdisplayfocus\": define(\"vrdisplayfocus\", base_event),\n    \"on_vrdisplaypointerrestricted\": define(\"vrdisplaypointerrestricted\", base_event),\n    \"on_vrdisplaypointerunrestricted\": define(\"vrdisplaypointerunrestricted\", base_event),\n    \"on_vrdisplaypresentchange\": define(\"vrdisplaypresentchange\", base_event),\n    \"on_waiting\": define(\"waiting\", base_event),\n} ","import Events from './events'\nenum OP_CODE {\n    ELEMENT_CREATE = 0,\n    ELEMENT_DELETE = 1,\n    ATTRIBUTE_SET = 2,\n    ATTRIBUTE_DELETE = 3,\n    TEXT_SET = 4,\n    TEXT_DELETE = 5,\n}\n\ntype Operation = [OP_CODE, string[], any]\n\nexport default class Nori {\n    private _root: HTMLElement\n    public onevent = (e: NoriEvent) => { }\n    constructor(root: HTMLElement) {\n        this._root = root\n    }\n\n    patch(ops: Operation[]) {\n        for (let op of ops) {\n            const [code, path, data] = op\n            switch (code) {\n                case OP_CODE.ELEMENT_DELETE:\n                    target(this._root, path).remove()\n                    break\n\n                case OP_CODE.ELEMENT_CREATE:\n                    const div = document.createElement('div')\n                    div.innerHTML = data\n                    path.splice(-1, 1)\n                    {\n                        const t = target(this._root, path)\n                        t.appendChild(div.firstChild)\n                        this.event_scan(t)\n                    }\n                    break\n\n                case OP_CODE.ATTRIBUTE_SET:\n                    const [key, value] = data\n                    {\n                        const t = target(this._root, path)\n                        const event = Event[key]\n                        if (event) this.event_bind(t, event, value)\n                        if (key === 'value') {\n                            (t as HTMLInputElement).value = value\n                            break\n                        }\n                        t.setAttribute(key, value)\n                    }\n                    break\n\n                case OP_CODE.ATTRIBUTE_DELETE:\n                    target(this._root, path).removeAttribute(data)\n                    break\n\n                case OP_CODE.TEXT_SET:\n                    target(this._root, path).innerHTML = data\n                    break\n\n                case OP_CODE.TEXT_DELETE:\n                    target(this._root, path).innerHTML = ''\n                    break\n\n                default:\n                    break\n            }\n        }\n    }\n\n    event_scan(t: Element, shallow = false) {\n        for (let i = 0; i < t.attributes.length; i++) {\n            const attr = t.attributes[i]\n            const event = Events[attr.name]\n            if (!event) continue\n            this.event_bind(t, event, attr.value)\n        }\n        if (shallow) return\n        for (let i = 0; i < t.children.length; i++) {\n            this.event_scan(t.children[i])\n        }\n    }\n\n    event_bind(\n        t: Element,\n        type: {\n            name: string,\n            transform: (e: Event) => any\n        },\n        handler: string\n    ) {\n        t.addEventListener(type.name, (evt) => {\n            this.onevent({\n                handler,\n                event: type.transform(evt)\n            })\n        }, false)\n    }\n}\n\ninterface NoriEvent {\n    handler: string\n    event: any\n}\n\n\n\nfunction target(root: HTMLElement, path: string[]) {\n    if (path.length === 0)\n        return root\n    const selector = path.map(item => `[nori=\"${item}\"]`).join(' > ')\n    return root.querySelector(selector)\n}","import * as Riptide from '@ironbay/riptide'\nimport Nori from '../../../js/src/index'\n\nconst root = document.getElementById('root')\nconst nori = new Nori(root)\n\n\nasync function run() {\n    const riptide = new Riptide.Client(Riptide.Transports.WS, Riptide.Formats.Json)\n    riptide.transport.connect('ws://localhost:12000/socket')\n    riptide.transport.on_status.add(async status => {\n        if (status !== 'ready') return\n        const patch = await riptide.call('nori.init', true) as any\n        root.innerHTML = ''\n        nori.patch(patch)\n    })\n\n    nori.onevent = async e => {\n        const patch = await riptide.call('nori.event', e) as any\n        nori.patch(patch)\n    }\n}\n\nrun()"]}